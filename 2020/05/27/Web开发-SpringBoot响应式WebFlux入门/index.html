<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Web开发-SpringBoot响应式WebFlux入门 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Spring Boot 响应式 WebFlux 入门1.概述1.1 响应式编程 在现在主流的编程模型中，请求是被同步阻塞处理完成，返回结果给前端。 在响应式的编程模型中，请求是被作为一个事件丢到线程池中执行，等到执行完毕，异步回调结果给主线程，最后返回给前端。  通过这样的方式，主线程不断接收请求，不负责直接同步阻塞处理，从而避免自身被阻塞。 1.2 Reactor 框架在 Java 生态中，提供">
<meta property="og:type" content="article">
<meta property="og:title" content="Web开发-SpringBoot响应式WebFlux入门">
<meta property="og:url" content="http://yoursite.com/2020/05/27/Web%E5%BC%80%E5%8F%91-SpringBoot%E5%93%8D%E5%BA%94%E5%BC%8FWebFlux%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Spring Boot 响应式 WebFlux 入门1.概述1.1 响应式编程 在现在主流的编程模型中，请求是被同步阻塞处理完成，返回结果给前端。 在响应式的编程模型中，请求是被作为一个事件丢到线程池中执行，等到执行完毕，异步回调结果给主线程，最后返回给前端。  通过这样的方式，主线程不断接收请求，不负责直接同步阻塞处理，从而避免自身被阻塞。 1.2 Reactor 框架在 Java 生态中，提供">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf760y1wdkj30ot0hbk22.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf84brpkg9j30ni0230u1.jpg">
<meta property="article:published_time" content="2020-05-27T09:47:41.000Z">
<meta property="article:modified_time" content="2020-05-28T06:02:05.054Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="Spring Boot-基础01">
<meta property="article:tag" content="Spring Boot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf760y1wdkj30ot0hbk22.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Web开发-SpringBoot响应式WebFlux入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/27/Web%E5%BC%80%E5%8F%91-SpringBoot%E5%93%8D%E5%BA%94%E5%BC%8FWebFlux%E5%85%A5%E9%97%A8/" class="article-date">
  <time datetime="2020-05-27T09:47:41.000Z" itemprop="datePublished">2020-05-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Web开发-SpringBoot响应式WebFlux入门
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Spring-Boot-响应式-WebFlux-入门"><a href="#Spring-Boot-响应式-WebFlux-入门" class="headerlink" title="Spring Boot 响应式 WebFlux 入门"></a>Spring Boot 响应式 WebFlux 入门</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h3><h4 id="1-1-响应式编程"><a href="#1-1-响应式编程" class="headerlink" title="1.1 响应式编程"></a>1.1 响应式编程</h4><ul>
<li>在现在主流的编程模型中，请求是被<strong>同步阻塞</strong>处理完成，返回结果给前端。</li>
<li>在响应式的编程模型中，请求是被作为<strong>一个事件</strong>丢到线程池中执行，等到执行完毕，<strong>异步</strong>回调结果给主线程，最后返回给前端。</li>
</ul>
<p>通过这样的方式，主线程不断接收请求，<strong>不负责直接同步阻塞处理</strong>，从而避免自身被阻塞。</p>
<h4 id="1-2-Reactor-框架"><a href="#1-2-Reactor-框架" class="headerlink" title="1.2 Reactor 框架"></a>1.2 Reactor 框架</h4><p>在 Java 生态中，提供响应式编程的框架主要有 <a href="https://projectreactor.io/" target="_blank" rel="noopener">Reactor</a>、<a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="noopener">RxJava</a>、<a href="https://community.oracle.com/docs/DOC-1006738" target="_blank" rel="noopener">JDK9 Flow API</a> 。</p>
<p>Reactor 有两个非常重要的基本概念：</p>
<ul>
<li><a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html" target="_blank" rel="noopener">Flux</a> ，表示的是包含 0 到 N 个元素的异步序列。当消息通知产生时，订阅者(<a href="https://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Subscriber.html" target="_blank" rel="noopener">Subscriber</a>)中对应的方法 <code>#onNext(t)</code>, <code>#onComplete(t)</code> 和 <code>#onError(t)</code> 会被调用。</li>
<li><a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html" target="_blank" rel="noopener">Mono</a> 表示的是包含 0 或者 1 个元素的异步序列。该序列中同样可以包含与 Flux 相同的三种类型的消息通知。</li>
<li>同时，Flux 和 Mono 之间可以进行转换。例如：<ul>
<li>对一个 Flux 序列进行计数操作，得到的结果是一个 <code>Mono&lt;Long&gt;</code> 对象。</li>
<li>把两个 Mono 序列合并在一起，得到的是一个 Flux 对象。</li>
</ul>
</li>
</ul>
<h4 id="1-3-Spring-WebFlux"><a href="#1-3-Spring-WebFlux" class="headerlink" title="1.3 Spring WebFlux"></a>1.3 Spring WebFlux</h4><p>Spring Framework 5 提供了一个新的 <a href="https://github.com/spring-projects/spring-framework/tree/master/spring-webflux" target="_blank" rel="noopener"><code>spring-webflux</code></a> 模块。该模块包含了：</p>
<ul>
<li>对响应式支持的 HTTP 和 WebSocket 客户端。</li>
<li>对响应式支持的 Web 服务器，包括 Rest API、HTML 浏览器、WebSocket 等交互方式。</li>
</ul>
<p>在服务端方面，WebFlux 提供了 2 种编程模型（翻译成使用方式，可能更易懂）：</p>
<ul>
<li>方式一，<strong>基于 Annotated Controller 方式实现</strong>：基于 <code>@Controller</code> 和 SpringMVC 使用的其它注解。也就是说，我们大体上可以像使用 SpringMVC 的方式，使用 WebFlux 。</li>
<li>方式二，<strong>基于函数式编程方式</strong>：函数式，Java 8 lambda 表达式风格的路由和处理。</li>
</ul>
<p>这两个编程模型，都是在同一个响应式基础（foundation）上执行的，该基础将非阻塞 HTTP 运行时（runtime）<strong>适配成</strong>响应式 API 。 简单来说，就是将原有的 API ，使用 Reactor 封装成响应式 API ，让开发者使用更加便捷。</p>
<p>WebFlux 可以运行在：</p>
<ul>
<li>支持 Servlet 3.1 非阻塞 IO API 的 Servlet 容器上</li>
<li>也可以运行在支持异步运行时的，例如说 Netty 或者 Undertow 上</li>
</ul>
<ul>
<li>对于 Servlet 来说， <a href="https://github.com/javaee/servlet-spec/blob/master/src/main/java/javax/servlet/ServletRequest.java#L139-L152" target="_blank" rel="noopener"><code>ServletRequest#getInputStream()</code></a> 方法，获得请求的主体内容返回的是 InputStream 对象。</li>
<li>对于 WebFlux 来说，<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/http/ReactiveHttpInputMessage.html#getBody--" target="_blank" rel="noopener"><code>ServerHttpRequest#getBody()</code></a> 方法，获得请求的主体内容返回的是 <code>Flux&lt;DataBuffer&gt;</code> 对象。</li>
</ul>
<h3 id="2-快速入门"><a href="#2-快速入门" class="headerlink" title="2. 快速入门"></a>2. 快速入门</h3><table>
<thead>
<tr>
<th align="left">请求方法</th>
<th align="left">URL</th>
<th align="left">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>GET</code></td>
<td align="left"><code>/users/list</code></td>
<td align="left">查询用户列表</td>
</tr>
<tr>
<td align="left"><code>GET</code></td>
<td align="left"><code>/users/get</code></td>
<td align="left">获得指定用户编号的用户</td>
</tr>
<tr>
<td align="left"><code>POST</code></td>
<td align="left"><code>/users/add</code></td>
<td align="left">添加用户</td>
</tr>
<tr>
<td align="left"><code>POST</code></td>
<td align="left"><code>/users/update</code></td>
<td align="left">更新指定用户编号的用户</td>
</tr>
<tr>
<td align="left"><code>POST</code></td>
<td align="left"><code>/users/delete</code></td>
<td align="left">删除指定用户编号的用户</td>
</tr>
</tbody></table>
<h4 id="2-1-引入依赖"><a href="#2-1-引入依赖" class="headerlink" title="2.1 引入依赖"></a>2.1 引入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 实现对 Spring WebFlux 的自动化配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>查看下 <code>spring-boot-starter-webflux</code> 依赖中，所引入的依赖。如下图所示：</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf760y1wdkj30ot0hbk22.jpg" alt="image-20200527180502298"></p>
<ul>
<li>引入 <a href="https://mvnrepository.com/artifact/io.projectreactor/reactor-core" target="_blank" rel="noopener"><code>reactor-core</code></a> 依赖，使用 Reactor 作为 WebFlux 的响应式框架的基础。</li>
<li>引入 <a href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-reactor-netty" target="_blank" rel="noopener"><code>spring-boot-starter-reactor-netty</code></a> 依赖，使用 Netty 构建 WebFlux 的 Web 服务器。其中 <a href="https://github.com/ReactiveX/RxNetty" target="_blank" rel="noopener">RxNetty</a> 库，是基于 Reactor 的响应式框架的基础之上，提供出 Netty 的响应式 API </li>
</ul>
<ul>
<li>在 Servlet 3.1 规范之前的版本，请求是<strong>只能</strong>被 Servlet 同步阻塞处理完成，返回结果给前端。</li>
<li>在 Servlet 3.1 规范开始的版本，请求是<strong>允许</strong>被 Servlet 丢到线程池中处执行，等到执行完毕，异步回调结果给 Servlet ，最后返回给前端。</li>
</ul>
<h4 id="2-2-Application"><a href="#2-2-Application" class="headerlink" title="2.2 Application"></a>2.2 Application</h4><h4 id="2-3-基于-Annotated-Controller-方式实现"><a href="#2-3-基于-Annotated-Controller-方式实现" class="headerlink" title="2.3 基于 Annotated Controller 方式实现"></a>2.3 基于 Annotated Controller 方式实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserController.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询用户列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Flux&lt;UserVO&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 查询列表</span></span><br><span class="line">        List&lt;UserVO&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        result.add(<span class="keyword">new</span> UserVO().setId(<span class="number">1</span>).setUsername(<span class="string">"yudaoyuanma"</span>));</span><br><span class="line">        result.add(<span class="keyword">new</span> UserVO().setId(<span class="number">2</span>).setUsername(<span class="string">"woshiyutou"</span>));</span><br><span class="line">        result.add(<span class="keyword">new</span> UserVO().setId(<span class="number">3</span>).setUsername(<span class="string">"chifanshuijiao"</span>));</span><br><span class="line">        <span class="comment">// 返回列表</span></span><br><span class="line">        <span class="keyword">return</span> Flux.fromIterable(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得指定用户编号的用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 用户编号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/get"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;UserVO&gt; <span class="title">get</span><span class="params">(@RequestParam(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">        <span class="comment">// 查询用户</span></span><br><span class="line">        UserVO user = <span class="keyword">new</span> UserVO().setId(id).setUsername(<span class="string">"username:"</span> + id);</span><br><span class="line">        <span class="comment">// 返回</span></span><br><span class="line">        <span class="keyword">return</span> Mono.just(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> addDTO 添加用户信息 DTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 添加成功的用户编号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Integer&gt; <span class="title">add</span><span class="params">(@RequestBody Publisher&lt;UserAddDTO&gt; addDTO)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 插入用户记录，返回编号</span></span><br><span class="line">        Integer returnId = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 返回用户编号</span></span><br><span class="line">        <span class="keyword">return</span> Mono.just(returnId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新指定用户编号的用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> updateDTO 更新用户信息 DTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否修改成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Boolean&gt; <span class="title">update</span><span class="params">(@RequestBody Publisher&lt;UserUpdateDTO&gt; updateDTO)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 更新用户记录</span></span><br><span class="line">        Boolean success = <span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">// 返回更新是否成功</span></span><br><span class="line">        <span class="keyword">return</span> Mono.just(success);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除指定用户编号的用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 用户编号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否删除成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/delete"</span>) <span class="comment">// URL 修改成 /delete ，RequestMethod 改成 DELETE</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Boolean&gt; <span class="title">delete</span><span class="params">(@RequestParam(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">        <span class="comment">// 删除用户记录</span></span><br><span class="line">        Boolean success = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// 返回是否更新成功</span></span><br><span class="line">        <span class="keyword">return</span> Mono.just(success);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在类和方法上，添加了 <code>@Controller</code> 和 SpringMVC 在使用的 <code>@GetMapping</code> 和 <code>PostMapping</code>等注解，提供 API 接口，这个和在使用 SpringMVC 是一模一样的。</li>
<li>在 <code>dto</code>和 <code>vo</code> 包下，有 API 使用到的 DTO 和 VO 类。</li>
<li><code>#list()</code> 方法，我们最终调用 <code>Flux#fromIterable(Iterable&lt;? extends T&gt; it)</code> 方法，将 List 包装成 Flux 对象返回。</li>
<li><code>#get(Integer id)</code> 方法，我们最终调用 <code>Mono#just(T data)</code> 方法，将 UserVO 包装成 Mono 对象返回。</li>
<li><code>#add(Publisher&lt;UserAddDTO&gt; addDTO)</code> 方法，参数为 <a href="https://www.reactive-streams.org/reactive-streams-1.0.0-javadoc/org/reactivestreams/Publisher.html" target="_blank" rel="noopener">Publisher</a> 类型，泛型为 UserAddDTO 类型，并且添加了 <code>@RequestBody</code> 注解，从 request 的 Body 中读取参数。注意，此时提交参数需要使用 <code>&quot;application/json&quot;</code> 等 Content-Type 内容类型。</li>
<li><code>#add(...)</code> 方法，也可以使用 <code>application/x-www-form-urlencoded</code> 或 <code>multipart/form-data</code> 这两个 Content-Type 内容类型，通过 request 的 Form Data 或 Multipart Data 传递参数。代码如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserController.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加用户</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> addDTO 添加用户信息 DTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 添加成功的用户编号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"add2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Mono&lt;Integer&gt; <span class="title">add</span><span class="params">(Mono&lt;UserAddDTO&gt; addDTO)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 插入用户记录，返回编号</span></span><br><span class="line">    Integer returnId = UUID.randomUUID().hashCode();</span><br><span class="line">    <span class="comment">// 返回用户编号</span></span><br><span class="line">    <span class="keyword">return</span> Mono.just(returnId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此时，参数为 Mono 类型，泛型为 UserAddDTO 类型。</li>
</ul>
<ul>
<li>当然，也可以直接使用参数为 UserAddDTO 类型。如果后续需要使用到 Reactor API ，则自己主动调用 <code>Mono#just(T data)</code> 方法，封装出 Publisher 对象。注意，Flux 和 Mono 都实现了 Publisher 接口。</li>
</ul>
<h4 id="2-4-基于函数式编程方式"><a href="#2-4-基于函数式编程方式" class="headerlink" title="2.4 基于函数式编程方式"></a>2.4 基于函数式编程方式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserRouter.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRouter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title">userListRouterFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> RouterFunctions.route(RequestPredicates.GET(<span class="string">"/users2/list"</span>),</span><br><span class="line">                <span class="keyword">new</span> HandlerFunction&lt;ServerResponse&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">handle</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">// 查询列表</span></span><br><span class="line">                        List&lt;UserVO&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                        result.add(<span class="keyword">new</span> UserVO().setId(<span class="number">1</span>).setUsername(<span class="string">"yudaoyuanma"</span>));</span><br><span class="line">                        result.add(<span class="keyword">new</span> UserVO().setId(<span class="number">2</span>).setUsername(<span class="string">"woshiyutou"</span>));</span><br><span class="line">                        result.add(<span class="keyword">new</span> UserVO().setId(<span class="number">3</span>).setUsername(<span class="string">"chifanshuijiao"</span>));</span><br><span class="line">                        <span class="comment">// 返回列表</span></span><br><span class="line">                        <span class="keyword">return</span> ServerResponse.ok().bodyValue(result);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title">userGetRouterFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> RouterFunctions.route(RequestPredicates.GET(<span class="string">"/users2/get"</span>),</span><br><span class="line">                <span class="keyword">new</span> HandlerFunction&lt;ServerResponse&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">handle</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">// 获得编号</span></span><br><span class="line">                        Integer id = request.queryParam(<span class="string">"id"</span>)</span><br><span class="line">                                .map(s -&gt; StringUtils.isEmpty(s) ? <span class="keyword">null</span> : Integer.valueOf(s)).get();</span><br><span class="line">                        <span class="comment">// 查询用户</span></span><br><span class="line">                        UserVO user = <span class="keyword">new</span> UserVO().setId(id).setUsername(UUID.randomUUID().toString());</span><br><span class="line">                        <span class="comment">// 返回列表</span></span><br><span class="line">                        <span class="keyword">return</span> ServerResponse.ok().bodyValue(user);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title">demoRouterFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> route(GET(<span class="string">"/users2/demo"</span>), request -&gt; ok().bodyValue(<span class="string">"demo"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在类上，添加 <code>@Configuration</code> 注解，保证该类中的 Bean 们，都被扫描到。</li>
<li>在每个方法中，都通弄 <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webflux/src/main/java/org/springframework/web/reactive/function/server/RouterFunctions.java" target="_blank" rel="noopener"><code>RouterFunctions#route(RequestPredicate predicate, HandlerFunction handlerFunction)</code></a>方法，定义了一条路由。<ul>
<li>第一个参数 <code>predicate</code> 参数，是 <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webflux/src/main/java/org/springframework/web/reactive/function/server/RequestPredicate.java" target="_blank" rel="noopener">RequestPredicate</a> 类型，请求谓语，用于匹配请求。可以通过 <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webflux/src/main/java/org/springframework/web/reactive/function/server/RequestPredicates.java" target="_blank" rel="noopener">RequestPredicates</a> 来构建各种条件。</li>
<li>第二个参数 <code>handlerFunction</code> 参数，是 <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webflux/src/main/java/org/springframework/web/reactive/function/server/RouterFunction.java" target="_blank" rel="noopener">RouterFunction</a> 类型，处理器函数。</li>
</ul>
</li>
</ul>
<h3 id="3-测试接口"><a href="#3-测试接口" class="headerlink" title="3. 测试接口"></a>3. 测试接口</h3><p>WebFlux 提供了 Web 测试客户端 <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/main/java/org/springframework/test/web/reactive/server/WebTestClient.java" target="_blank" rel="noopener">WebTestClient</a> 类</p>
<h4 id="3-1-集成测试"><a href="#3-1-集成测试" class="headerlink" title="3.1 集成测试"></a>3.1 集成测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserControllerTest.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span> </span>= Application<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureWebFlux</span></span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureWebTestClient</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">UserControllerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebTestClient webClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        webClient.get().uri(<span class="string">"/users/list"</span>)</span><br><span class="line">                .exchange() <span class="comment">// 执行请求</span></span><br><span class="line">                .expectStatus().isOk() <span class="comment">// 响应状态码 200</span></span><br><span class="line">                .expectBody().json(<span class="string">"[\n"</span> +</span><br><span class="line">                <span class="string">"    &#123;\n"</span> +</span><br><span class="line">                <span class="string">"        \"id\": 1,\n"</span> +</span><br><span class="line">                <span class="string">"        \"username\": \"yudaoyuanma\"\n"</span> +</span><br><span class="line">                <span class="string">"    &#125;,\n"</span> +</span><br><span class="line">                <span class="string">"    &#123;\n"</span> +</span><br><span class="line">                <span class="string">"        \"id\": 2,\n"</span> +</span><br><span class="line">                <span class="string">"        \"username\": \"woshiyutou\"\n"</span> +</span><br><span class="line">                <span class="string">"    &#125;,\n"</span> +</span><br><span class="line">                <span class="string">"    &#123;\n"</span> +</span><br><span class="line">                <span class="string">"        \"id\": 3,\n"</span> +</span><br><span class="line">                <span class="string">"        \"username\": \"chifanshuijiao\"\n"</span> +</span><br><span class="line">                <span class="string">"    &#125;\n"</span> +</span><br><span class="line">                <span class="string">"]"</span>); <span class="comment">// 响应结果</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获得指定用户编号的用户</span></span><br><span class="line">        webClient.get().uri(<span class="string">"/users/get?id=1"</span>)</span><br><span class="line">                .exchange() <span class="comment">// 执行请求</span></span><br><span class="line">                .expectStatus().isOk() <span class="comment">// 响应状态码 200</span></span><br><span class="line">                .expectBody().json(<span class="string">"&#123;\n"</span> +</span><br><span class="line">                <span class="string">"    \"id\": 1,\n"</span> +</span><br><span class="line">                <span class="string">"    \"username\": \"username:1\"\n"</span> +</span><br><span class="line">                <span class="string">"&#125;"</span>); <span class="comment">// 响应结果</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获得指定用户编号的用户</span></span><br><span class="line">        webClient.get().uri(<span class="string">"/users/v2/get?id=1"</span>)</span><br><span class="line">                .exchange() <span class="comment">// 执行请求</span></span><br><span class="line">                .expectStatus().isOk() <span class="comment">// 响应状态码 200</span></span><br><span class="line">                .expectBody().json(<span class="string">"&#123;\n"</span> +</span><br><span class="line">                <span class="string">"    \"id\": 1,\n"</span> +</span><br><span class="line">                <span class="string">"    \"username\": \"test\"\n"</span> +</span><br><span class="line">                <span class="string">"&#125;"</span>); <span class="comment">// 响应结果</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">"username"</span>, <span class="string">"yudaoyuanma"</span>);</span><br><span class="line">        params.put(<span class="string">"password"</span>, <span class="string">"nicai"</span>);</span><br><span class="line">        <span class="comment">// 添加用户</span></span><br><span class="line">        webClient.post().uri(<span class="string">"/users/add"</span>)</span><br><span class="line">                .bodyValue(params)</span><br><span class="line">                .exchange() <span class="comment">// 执行请求</span></span><br><span class="line">                .expectStatus().isOk() <span class="comment">// 响应状态码 200</span></span><br><span class="line">                .expectBody().json(<span class="string">"1"</span>); <span class="comment">// 响应结果。因为没有提供 content 的比较，所以只好使用 json 来比较。竟然能通过</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd2</span><span class="params">()</span> </span>&#123; <span class="comment">// 发送文件的测试，可以参考 https://dev.to/shavz/sending-multipart-form-data-using-spring-webtestclient-2gb7 文章</span></span><br><span class="line">        BodyInserters.FormInserter&lt;String&gt; formData = <span class="comment">// Form Data 数据，需要这么拼凑</span></span><br><span class="line">                BodyInserters.fromFormData(<span class="string">"username"</span>, <span class="string">"yudaoyuanma"</span>)</span><br><span class="line">                .with(<span class="string">"password"</span>, <span class="string">"nicai"</span>);</span><br><span class="line">        <span class="comment">// 添加用户</span></span><br><span class="line">        webClient.post().uri(<span class="string">"/users/add2"</span>)</span><br><span class="line">                .body(formData)</span><br><span class="line">                .exchange() <span class="comment">// 执行请求</span></span><br><span class="line">                .expectStatus().isOk() <span class="comment">// 响应状态码 200</span></span><br><span class="line">                .expectBody().json(<span class="string">"1"</span>); <span class="comment">// 响应结果。因为没有提供 content 的比较，所以只好使用 json 来比较。竟然能通过</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">"id"</span>, <span class="number">1</span>);</span><br><span class="line">        params.put(<span class="string">"username"</span>, <span class="string">"yudaoyuanma"</span>);</span><br><span class="line">        <span class="comment">// 修改用户</span></span><br><span class="line">        webClient.post().uri(<span class="string">"/users/update"</span>)</span><br><span class="line">                .bodyValue(params)</span><br><span class="line">                .exchange() <span class="comment">// 执行请求</span></span><br><span class="line">                .expectStatus().isOk() <span class="comment">// 响应状态码 200</span></span><br><span class="line">                .expectBody(Boolean<span class="class">.<span class="keyword">class</span>) // 期望返回值类型是 <span class="title">Boolean</span></span></span><br><span class="line"><span class="class">                .<span class="title">consumeWith</span>((<span class="title">Consumer</span>&lt;<span class="title">EntityExchangeResult</span>&lt;<span class="title">Boolean</span>&gt;&gt;) <span class="title">result</span> -&gt; // 通过消费结果，判断符合是 <span class="title">true</span> 。</span></span><br><span class="line">                        Assert.assertTrue("返回结果需要为 true", result.getResponseBody()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 删除用户</span></span><br><span class="line">        webClient.post().uri(<span class="string">"/users/delete?id=1"</span>)</span><br><span class="line">                .exchange() <span class="comment">// 执行请求</span></span><br><span class="line">                .expectStatus().isOk() <span class="comment">// 响应状态码 200</span></span><br><span class="line">                .expectBody(Boolean<span class="class">.<span class="keyword">class</span>) // 期望返回值类型是 <span class="title">Boolean</span></span></span><br><span class="line"><span class="class">                .<span class="title">isEqualTo</span>(<span class="title">true</span>)</span>; <span class="comment">// 这样更加简洁一些</span></span><br><span class="line"><span class="comment">//                .consumeWith((Consumer&lt;EntityExchangeResult&lt;Boolean&gt;&gt;) result -&gt; // 通过消费结果，判断符合是 true 。</span></span><br><span class="line"><span class="comment">//                        Assert.assertTrue("返回结果需要为 true", result.getResponseBody()));</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在类上，添加了 <code>@AutoConfigureWebTestClient</code> 注解，用于自动化配置稍后注入的 WebTestClient Bean 对象 <code>webClient</code> 。在后续的测试中，会看到都是通过 <code>webClient</code> 调用后端 API 接口。而每一次调用后端 API 接口，都会执行<strong>真正的后端逻辑</strong>。因此，整个逻辑，走的是<strong>集成测试</strong>，会启动一个<strong>真实</strong>的 Spring 环境。</li>
</ul>
<ul>
<li>每次 API 接口的请求，都通过 RequestHeadersSpec来构建。构建完成后，通过 <code>RequestHeadersSpec#exchange()</code> 方法来执行请求，返回 ResponseSpec 结果。<ul>
<li>WebTestClient 的 <code>#get()</code>、<code>#head()</code>、<code>#delete()</code>、<code>#options()</code> 方法，返回的是 <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/reactive/function/client/WebClient.RequestHeadersUriSpec.html" target="_blank" rel="noopener">RequestHeadersUriSpec</a> 对象。</li>
<li>WebTestClient 的 <code>#post()</code>、<code>#put()</code>、<code>#delete()</code>、<code>#patch()</code> 方法，返回的是 <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/reactive/function/client/WebClient.RequestBodyUriSpec.html" target="_blank" rel="noopener">RequestBodyUriSpec</a> 对象。</li>
<li>RequestHeadersUriSpec 和 RequestBodyUriSpec 都继承了 RequestHeadersSpec 接口。</li>
</ul>
</li>
<li>执行完请求后，通过调用 <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/reactive/function/client/WebClient.RequestBodyUriSpec.html" target="_blank" rel="noopener">RequestBodyUriSpec</a> 的各种断言方法，添加对结果的预期，相当于做断言。如果不符合预期，则会抛出异常，测试不通过。</li>
</ul>
<h4 id="3-4-单元测试"><a href="#3-4-单元测试" class="headerlink" title="3.4 单元测试"></a>3.4 单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserService.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserVO <span class="title">get</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserVO().setId(id).setUsername(<span class="string">"test"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserController.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获得指定用户编号的用户</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 用户编号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/v2/get"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Mono&lt;UserVO&gt; <span class="title">get2</span><span class="params">(@RequestParam(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">    <span class="comment">// 查询用户</span></span><br><span class="line">    UserVO user = userService.get(id);</span><br><span class="line">    <span class="comment">// 返回</span></span><br><span class="line">    <span class="keyword">return</span> Mono.just(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在代码中，我们注入了 UserService Bean 对象 <code>userService</code> ，然后在新增的接口方法中，会调用 <code>UserService#get(Integer id)</code> 方法，获得指定用户编号的用户。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserControllerTest2.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">WebFluxTest</span>(<span class="title">UserController</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">UserControllerTest2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebTestClient webClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet2</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// Mock UserService 的 get 方法</span></span><br><span class="line">        System.out.println(<span class="string">"before mock:"</span> + userService.get(<span class="number">1</span>)); <span class="comment">// &lt;1.1&gt;</span></span><br><span class="line">        Mockito.when(userService.get(<span class="number">1</span>)).thenReturn(</span><br><span class="line">                <span class="keyword">new</span> UserVO().setId(<span class="number">1</span>).setUsername(<span class="string">"username:1"</span>)); <span class="comment">// &lt;1.2&gt;</span></span><br><span class="line">        System.out.println(<span class="string">"after mock:"</span> + userService.get(<span class="number">1</span>)); <span class="comment">// &lt;1.3&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询用户列表</span></span><br><span class="line">        webClient.get().uri(<span class="string">"/users/v2/get?id=1"</span>)</span><br><span class="line">                .exchange() <span class="comment">// 执行请求</span></span><br><span class="line">                .expectStatus().isOk() <span class="comment">// 响应状态码 200</span></span><br><span class="line">                .expectBody().json(<span class="string">"&#123;\n"</span> +</span><br><span class="line">                <span class="string">"    \"id\": 1,\n"</span> +</span><br><span class="line">                <span class="string">"    \"username\": \"username:1\"\n"</span> +</span><br><span class="line">                <span class="string">"&#125;"</span>); <span class="comment">// 响应结果</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在类上添加 <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/web/reactive/WebFluxTest.java" target="_blank" rel="noopener"><code>@WebFluxTest</code></a> 注解，并且传入的是 UserController 类，表示我们要对 UserController 进行单元测试。</li>
<li>同时，<code>@WebFluxTest</code> 注解，是包含了 <code>@UserController</code> 的组合注解，所以它会自动化配置我们稍后注入的 WebTestClient Bean 对象 <code>mvc</code> 。在后续的测试中，我们会看到都是通过 <code>webClient</code> 调用后端 API 接口。<strong>但是</strong>！每一次调用后端 API 接口，并<strong>不会</strong>执行<strong>真正的后端逻辑</strong>，而是走的 Mock 逻辑。也就是说，整个逻辑，走的是<strong>单元测试</strong>，<strong>只</strong>会启动一个 <strong>Mock</strong> 的 Spring 环境。</li>
</ul>
<p><code>userService</code> 属性，我们添加了 <a href="http://static.iocoder.cn/236a666ca95f7db40bdd3455739d8e41" target="_blank" rel="noopener"><code>@MockBean</code></a> 注解，实际这里注入的是一个使用 <a href="https://site.mockito.org/" target="_blank" rel="noopener">Mockito</a> 创建的 UserService Mock 代理对象。如下图所示：</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf84brpkg9j30ni0230u1.jpg" alt="image-20200528135144563"></p>
<ul>
<li>UserController 中，也会注入一个 UserService 属性，此时注入的就是该 Mock 出来的 UserService Bean 对象。</li>
<li>默认情况下，<code>&lt;1.1&gt;</code> 处，调用 <code>UserService#get(Integer id)</code> 方法，然后打印返回结果。执行结果如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">before mock:<span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>结果竟然返回的是 <code>null</code> 空。理论来说，此时应该返回一个 <code>id = 1</code> 的 UserVO 对象。实际上，因为此时的 <code>userService</code> 是通过 Mockito 来 Mock 出来的对象，其所有调用它的方法，返回的都是空。</p>
</li>
<li><p><code>&lt;1.2&gt;</code> 处，通过 Mockito 进行 Mock <code>userService</code> 的 <code>#get(Integer id)</code> 方法，当传入的 <code>id = 1</code> 方法参数时，返回 <code>id = 1</code> 并且 <code>username = &quot;username:1&quot;</code> 的 UserVO 对象。</p>
</li>
<li><p><code>&lt;1.3&gt;</code> 处，再次调用 <code>UserService#get(Integer id)</code> 方法，然后打印返回结果。执行结果如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">after cn.iocoder.springboot.lab27.springwebflux.vo.UserVO@<span class="number">23202</span>c31</span><br></pre></td></tr></table></figure>

<ul>
<li>打印的就是 Mock 返回的 UserVO 对象。</li>
</ul>
</li>
</ul>
<h3 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h3><p>概括 WebFlux 的话，那就是：</p>
<ul>
<li>WebFlux 在 Spring Framework 5 推出的，以 Reactor 库为基础，基于异步和事件驱动，实现的响应式 Web 开发框架。</li>
<li>WebFlux 能够充分利用多核 CPU 的硬件资源，处理大量的并发请求。因此，可以在不扩充硬件的资源的情况下，提升系统的吞吐性和伸缩性。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/27/Web%E5%BC%80%E5%8F%91-SpringBoot%E5%93%8D%E5%BA%94%E5%BC%8FWebFlux%E5%85%A5%E9%97%A8/" data-id="ckbg9kuco00102r077zob9vad" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/" rel="tag">Spring Boot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot-%E5%9F%BA%E7%A1%8001/" rel="tag">Spring Boot-基础01</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/" rel="tag">Web</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/05/28/Java%E5%AE%9E%E8%B7%B5%E6%8E%A8%E8%8D%90/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Java实践推荐
        
      </div>
    </a>
  
  
    <a href="/2020/05/26/Java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Java集合框架</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI-CD/" rel="tag">CI/CD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cache/" rel="tag">Cache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitea/" rel="tag">Gitea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JPA/" rel="tag">JPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-%E5%9F%BA%E7%A1%80-01/" rel="tag">Java 基础-01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jetty/" rel="tag">Jetty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPring-Boot-%E5%9F%BA%E7%A1%80-01/" rel="tag">SPring Boot-基础-01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Boot/" rel="tag">Spring Boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Boot-%E5%9F%BA%E7%A1%80-01/" rel="tag">Spring Boot-基础-01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Boot-%E5%9F%BA%E7%A1%80-02/" rel="tag">Spring Boot-基础-02</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Boot-%E5%9F%BA%E7%A1%8001/" rel="tag">Spring Boot-基础01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringMVC/" rel="tag">SpringMVC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swagger/" rel="tag">Swagger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TeamCity/" rel="tag">TeamCity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/" rel="tag">Tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Undertow/" rel="tag">Undertow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Validation/" rel="tag">Validation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/" rel="tag">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebFlux/" rel="tag">WebFlux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" rel="tag">分布式锁</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/" rel="tag">基准测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="tag">基础知识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%B9%E5%99%A8/" rel="tag">容器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/" rel="tag">数据库连接池</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/" rel="tag">数据访问</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" rel="tag">线程池</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%93%E5%AD%98/" rel="tag">缓存</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E5%90%88/" rel="tag">集合</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/Cache/" style="font-size: 10px;">Cache</a> <a href="/tags/Gitea/" style="font-size: 10px;">Gitea</a> <a href="/tags/JPA/" style="font-size: 10px;">JPA</a> <a href="/tags/Java/" style="font-size: 18px;">Java</a> <a href="/tags/Java-%E5%9F%BA%E7%A1%80-01/" style="font-size: 12px;">Java 基础-01</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/Jetty/" style="font-size: 10px;">Jetty</a> <a href="/tags/MyBatis/" style="font-size: 10px;">MyBatis</a> <a href="/tags/Redis/" style="font-size: 12px;">Redis</a> <a href="/tags/SPring-Boot-%E5%9F%BA%E7%A1%80-01/" style="font-size: 10px;">SPring Boot-基础-01</a> <a href="/tags/Spring-Boot/" style="font-size: 20px;">Spring Boot</a> <a href="/tags/Spring-Boot-%E5%9F%BA%E7%A1%80-01/" style="font-size: 16px;">Spring Boot-基础-01</a> <a href="/tags/Spring-Boot-%E5%9F%BA%E7%A1%80-02/" style="font-size: 10px;">Spring Boot-基础-02</a> <a href="/tags/Spring-Boot-%E5%9F%BA%E7%A1%8001/" style="font-size: 16px;">Spring Boot-基础01</a> <a href="/tags/SpringMVC/" style="font-size: 10px;">SpringMVC</a> <a href="/tags/Swagger/" style="font-size: 10px;">Swagger</a> <a href="/tags/TeamCity/" style="font-size: 10px;">TeamCity</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/Undertow/" style="font-size: 10px;">Undertow</a> <a href="/tags/Validation/" style="font-size: 10px;">Validation</a> <a href="/tags/Web/" style="font-size: 14px;">Web</a> <a href="/tags/WebFlux/" style="font-size: 10px;">WebFlux</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 10px;">分布式锁</a> <a href="/tags/%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">基准测试</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">基础</a> <a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 10px;">基础知识</a> <a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 10px;">容器</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/" style="font-size: 10px;">数据库连接池</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/" style="font-size: 12px;">数据访问</a> <a href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" style="font-size: 10px;">线程池</a> <a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 10px;">缓存</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 12px;">设计模式</a> <a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 10px;">集合</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 10px;">面试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/15/%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/gitea_%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4/">page</a>
          </li>
        
          <li>
            <a href="/2021/04/12/docker/docker_%E5%91%BD%E4%BB%A4/">docker 命令</a>
          </li>
        
          <li>
            <a href="/2020/07/27/TeamCityVSJenkins%E9%80%89%E6%8B%A9%E6%AD%A3%E7%A1%AE%E7%9A%84CI-CD%E5%B7%A5%E5%85%B7/">TeamCityVSJenkins选择正确的CI/CD工具</a>
          </li>
        
          <li>
            <a href="/2020/07/27/SpringMvc-%E5%9F%BA%E7%A1%80/">SpringMvc-基础</a>
          </li>
        
          <li>
            <a href="/2020/07/17/Redis-%E5%9F%BA%E4%BA%8ERedis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/">Redis-基于Redis分布式锁</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>